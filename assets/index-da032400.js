import{m as V,a as e,j as u,n as T,o as m,F as H,k as g,a5 as K,a6 as L,a7 as M,a8 as B,r as s,a9 as E,u as x,b as A,c as R,S as D,I as k,B as S,d as j,p as F,q as I,f as P,t as _,H as $}from"./index-7258077c.js";import{D as q,C as z,a as G,b as J}from"./DbHeader-8252df35.js";import{T as N,S as O}from"./ShowPayload-71f75581.js";const Q={Table:n=>e(K,{...n}),TableHead:L,TableRow:T,TableCaption:M,TableContainer:B,TableBody:s.forwardRef((n,o)=>e(E,{...n,ref:o}))};function U({entries:n}){const o=V("gray.200","gray.800");return e(N,{style:{height:400},data:n,overscan:200,components:Q,fixedHeaderContent:()=>u(T,{bg:o,children:[e(m,{w:100,textAlign:"center",children:"#"}),e(m,{w:100,textAlign:"center",children:"{ }"}),e(m,{w:230,children:"Date"}),e(m,{w:230,children:"Key"}),e(m,{w:"calc(100% - 630px)",children:"Value"})]}),itemContent:(l,r)=>u(H,{children:[u(g,{w:100,textAlign:"center",children:[" ",l]}),e(g,{w:100,textAlign:"center",children:e(O,{payload:r.payload})}),e(g,{w:230,children:r.date.toLocaleString()}),e(g,{w:230,children:r.key}),e(g,{w:"calc(100% - 630px)",children:r.value})]})})}function W({onRefresh:n,onAddEvent:o}){const[l,r]=s.useState(""),[d,h]=s.useState(""),{id:p}=x(),{findDb:i}=A(),y=R(),t=s.useMemo(()=>i(p||""),[p,i]);return u(D,{spacing:4,direction:{base:"column",md:"row"},children:[e(k,{placeholder:"Key",variant:"outline",value:d,onChange:a=>h(a.target.value)}),e(k,{placeholder:"Value",variant:"outline",value:l,onChange:a=>r(a.target.value)}),e(S,{width:"sm",variant:"outline",onClick:n,children:"Regresh"}),e(S,{width:"sm",variant:"outline",onClick:async()=>{try{if(!l||!d||!t)return;const a={key:d,value:l,timestamp:Date.now()},v=await j(t==null?void 0:t.payload.value.address,{pin:!1,entry:a});o(d),y({type:"add",log:{id:v,text:`Added keyvalue  to \`${t==null?void 0:t.payload.value.name}\` db`,type:"created"}})}catch(a){y({type:"add",log:{text:`Failed to add keyvalue to \`${t==null?void 0:t.payload.value.name}\` db - ${(a==null?void 0:a.message)||"unknown error"}`,type:"error"}})}},children:"Set"})]})}function ae(){const{id:n}=x(),{findDb:o}=A(),[l,r]=s.useState([]),d=F(),h=s.useMemo(()=>o(n||""),[n,o]),p=s.useMemo(()=>h==null?void 0:h.payload.value.address,[h]),i=s.useCallback(async f=>{try{if(!p)return;I({title:"Loading key values log..."});const a=await P(p,{query:{reverse:!0,limit:-1}});if(!a)return;const v=a.map(c=>{var w,b,C;return{date:new Date(((w=c.payload.value)==null?void 0:w.timestamp)||0),key:String(((b=c.payload)==null?void 0:b.key)||""),value:String(((C=c.payload.value)==null?void 0:C.value)||c.payload.value),payload:c}});if(!d())return;r(f?v:c=>[...c,...v])}catch(a){console.error(a)}finally{_()}},[p,d]);s.useEffect(()=>{i(!1)},[i]);const y=s.useCallback(async()=>{try{await i(!0)}catch(f){console.error(f)}},[i]),t=s.useCallback(async f=>{y()},[y]);return u(D,{spacing:4,children:[e(q,{multiHash:n||"",entriesCount:0,showEntriesCount:!1}),u(z,{children:[u(G,{children:[e($,{fontSize:"sm",mb:2,children:"Set a value for a key"}),e(W,{onAddEvent:t,onRefresh:y}),e("br",{})]}),e(J,{children:e(U,{entries:l||[]})})]})]})}export{ae as default};
