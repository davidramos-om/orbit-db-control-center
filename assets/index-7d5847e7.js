import{r as d,u as A,b as x,c as E,j as h,S as D,a as e,I as k,B as b,d as L,m as T,n as H,o as v,F as M,k as f,p as B,q as I,f as V,t as _,v as j,H as F}from"./index-7258077c.js";import{D as P,C as R,a as $,b as q}from"./DbHeader-8252df35.js";import{T as z,S as G}from"./ShowPayload-71f75581.js";import{T as J}from"./Virtuoso-46c58dc7.js";function K({onRefresh:i,onAddEvent:p}){const[l,n]=d.useState(""),{id:g}=A(),{findDb:c}=x(),r=E(),t=d.useMemo(()=>c(g||""),[g,c]);return h(D,{spacing:4,direction:{base:"column",md:"row"},children:[e(k,{variant:"outline",value:l,onChange:o=>n(o.target.value)}),e(b,{variant:"outline",onClick:i,children:"Regresh"}),e(b,{variant:"outline",onClick:async()=>{try{if(!l||!t)return;const o={value:l,timestamp:Date.now()},s=await L(t==null?void 0:t.payload.value.address,{pin:!1,entry:o});p(s),r({type:"add",log:{id:s,text:`Added event  to \`${t==null?void 0:t.payload.value.name}\` db`,type:"created"}})}catch(o){r({type:"add",log:{text:`Failed to add event to \`${t==null?void 0:t.payload.value.name}\` db - ${(o==null?void 0:o.message)||"unknown error"}`,type:"error"}})}},children:"Add event"})]})}function N({entries:i}){const p=T("gray.200","gray.800");return e(z,{style:{height:400},data:i,overscan:200,components:J,fixedHeaderContent:()=>h(H,{bg:p,children:[e(v,{w:100,textAlign:"center",children:"#"}),e(v,{w:60,textAlign:"center",children:"{ }"}),e(v,{w:200,children:"Id"}),e(v,{w:230,children:"Date"}),e(v,{w:"calc(100% - 590px)",children:"Value"})]}),itemContent:(l,n)=>h(M,{children:[h(f,{w:100,textAlign:"center",children:[" ",l]}),e(f,{w:50,textAlign:"center",children:e(G,{payload:n.payload})}),e(f,{w:200,children:n.id}),e(f,{w:230,children:n.date.toLocaleString()}),e(f,{w:"calc(100% - 590px)",children:n.value})]})})}function X(){const{id:i}=A(),{findDb:p}=x(),[l,n]=d.useState([]),g=B(),c=d.useMemo(()=>p(i||""),[i,p]),r=d.useMemo(()=>c==null?void 0:c.payload.value.address,[c]),t=d.useCallback(async s=>{try{if(!r)return;I({title:"Loading event log..."});const u=await V(r,{query:{reverse:!0,limit:-1}});if(!u)return;const m=u.map(a=>{var y,S;return{id:String(a.hash),date:new Date(((y=a.payload.value)==null?void 0:y.timestamp)||0),value:String(((S=a.payload.value)==null?void 0:S.value)||a.payload.value),payload:a}});if(!g())return;n(s?m:a=>[...a,...m])}catch(u){console.error(u)}finally{_()}},[r,g]);d.useEffect(()=>{t(!1)},[t]);const w=d.useCallback(async()=>{try{await t(!0)}catch(s){console.error(s)}},[t]),o=d.useCallback(async s=>{var u,m;try{if(!r||!s)return;const a=await j(r,s);if(!a)return;const C={id:String(a.hash),date:new Date(((u=a.payload.value)==null?void 0:u.timestamp)||0),value:String(((m=a.payload.value)==null?void 0:m.value)||a.payload.value),payload:a};n(y=>[C,...y])}catch(a){console.error(a)}},[r]);return h(D,{spacing:4,children:[e(P,{multiHash:i||"",entriesCount:l.length,showEntriesCount:!0}),h(R,{children:[h($,{children:[e(F,{fontSize:"sm",mb:2,children:"Add an immutable event to the log"}),e(K,{onAddEvent:o,onRefresh:w}),e("br",{})]}),e(q,{children:e(N,{entries:l||[]})})]})]})}export{X as default};
