import{r as c,e as E,c as v,j as d,S,a as e,B as D,g as k,i as A,d as T,h as I,F as J,k as y,l as O,m as $,n as j,o as w,u as F,b as H,p as M,q as P,f as L,t as N,H as B}from"./index-7258077c.js";import{D as R,C as V,a as _,b as q}from"./DbHeader-8252df35.js";import{I as z,T as G,a as K,E as Q,C as U,D as W}from"./DeleteEntryButton-8c1c613d.js";import{S as X,T as Y}from"./ShowPayload-71f75581.js";import{T as Z}from"./Virtuoso-46c58dc7.js";function ee({dbAddress:l,dbName:s,onRefresh:a,onEntryAdded:h}){const[n,r]=c.useState(""),[o,i]=c.useState(!0),[m,b]=c.useState(!1),u=E(),C=v();return d(S,{spacing:4,children:[d(S,{spacing:4,direction:{base:"column",md:"row"},alignContent:"center",alignItems:"center",children:[e(S,{spacing:4,width:"full",children:d(z,{children:[e(G,{placeholder:"Document or Plain Text",variant:"outline",value:n,disabled:m,onChange:t=>r(t.target.value)}),e(K,{w:{base:"unset",md:"auto"},p:1,children:e(Q,{json:n,onAccept:t=>{r(t)},children:e(D,{variant:"solid",color:"white",colorScheme:"blackAlpha",h:"1.75rem",children:n?"Edit JSON":"Enter JSON"})})})]})}),e(U,{isChecked:o,width:{base:"100%",md:"auto"},onChange:t=>{i(t.target.checked),b(t.target.checked)},children:"Strict JSON"})]}),d(S,{spacing:4,direction:{base:"column",md:"row"},children:[e(k,{}),e(D,{variant:"outline",onClick:a,children:"Regresh"}),e(D,{variant:"outline",onClick:async()=>{try{if(!l)return;if(!n){u.closeAll(),u({position:"top-right",description:"Please provide a value",status:"error",isClosable:!0});return}if(o&&!A(n)){u.closeAll(),u({position:"top-right",description:"Invalid JSON",status:"error",isClosable:!0});return}const t={document:o?JSON.parse(n):n,strictMode:o,timestamp:Date.now()},p=await T(l,{pin:!1,entry:t});h(p),C({type:"add",log:{id:p,text:`Feed added to \`${s}\` db`,type:"created"}})}catch(t){C({type:"add",log:{text:`Failed to add feed to \`${s}\` db - ${(t==null?void 0:t.message)||"something went wrong"}`,type:"error"}})}},children:"Add Entry"})]})]})}function te({index:l,dbAddress:s,log:a}){const[h,n]=c.useState(!1),r=v(),o=c.useCallback(async()=>{try{await I(s,a.hash),r({type:"add",log:{type:"deleted",text:`Entry ${a.hash} deleted from ${s}`}}),n(!0)}catch(m){r({type:"add",log:{type:"error",text:`Error deleting entry ${a.hash} from ${s}: ${m.message||"something went wrong"}`}})}},[s,r,a.hash]),i={textDecoration:h?"line-through":"none",opacity:h?.5:1};return d(J,{children:[d(y,{w:100,textAlign:"center",children:[" ",l+1]}),e(y,{w:50,textAlign:"center",children:d(O,{children:[e(X,{payload:a.payload}),e(W,{dbAddress:s,identifier:a.hash,onDelete:o})]})}),e(y,{w:200,sx:i,children:a.hash}),e(y,{w:230,sx:i,children:a.date.toLocaleString()}),e(y,{w:"calc(100% - 590px)",sx:i,children:a.jsonPreview})]})}function ae({dbAddress:l,entries:s}){const a=$("gray.200","gray.800");return e(Y,{style:{height:400},data:s,overscan:200,components:Z,fixedHeaderContent:()=>d(j,{bg:a,children:[e(w,{w:100,textAlign:"center",children:"#"}),e(w,{w:60,textAlign:"center",children:"{ }"}),e(w,{w:200,children:"Id"}),e(w,{w:230,children:"Date"}),e(w,{w:"calc(100% - 590px)",children:"Value"})]}),itemContent:(h,n)=>e(te,{index:h,dbAddress:l,log:n},n.hash)})}function de(){const{id:l}=F(),{findDb:s}=H(),[a,h]=c.useState([]),n=M(),r=c.useMemo(()=>s(l||""),[l,s]),o=c.useMemo(()=>r==null?void 0:r.payload.value.address,[r]),i=c.useCallback(async(u,C)=>{try{if(!o)return;C&&P({title:"Loading feed log..."});const g=await L(o,{docsOptions:{fullOp:!0},query:{reverse:!0,limit:-1}});if(!g)return;const x=g.map(t=>{const p=t.payload.value||{};let f="";return typeof p.document!="object"?f=String(p.document):f=JSON.stringify(t.payload.value.document,null,2),f=f.substring(0,100)+"...",{hash:String(t.hash||""),date:new Date(p.timestamp||0),jsonPreview:f,payload:t}});if(!n())return;h(u?x:t=>[...t,...x])}catch(g){console.error(g)}finally{N()}},[o,n]);c.useEffect(()=>{i(!1,!0)},[i]);const m=c.useCallback(async()=>{try{await i(!0,!0)}catch(u){console.error(u)}},[i]),b=c.useCallback(()=>{i(!0,!1)},[i]);return d(S,{spacing:4,children:[e(R,{multiHash:l||"",entriesCount:a.length,showEntriesCount:!0}),d(V,{children:[d(_,{children:[e(B,{fontSize:"sm",mb:2,children:"Add an entry to the feed"}),e(ee,{onEntryAdded:b,onRefresh:m,dbAddress:o||"",dbName:(r==null?void 0:r.payload.value.name)||""}),e("br",{})]}),e(q,{children:e(ae,{dbAddress:o||"",entries:a||[]})})]})]})}export{de as default};
